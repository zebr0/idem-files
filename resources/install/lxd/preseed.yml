---
storage_pools:
  - name: default
    driver: zfs

networks:
  - name: lxd0
    type: bridge
    config:
      ipv4.address: 10.42.0.1/24
      ipv4.nat: true
      ipv6.address: none
      dns.mode: dynamic
      dns.domain: lxd

profiles:
  - name: default
    config:
      user.user-data: |
        #cloud-config
        ssh_authorized_keys:
          - {{ cat /home/ubuntu/.ssh/id_rsa.pub }}
        runcmd:
          - add-apt-repository -y ppa:zebr0/master
          - apt-get update
          - apt-get -y install idem
    devices:
      root:
        type: disk
        path: /
        pool: default
      eth0:
        type: nic
        nictype: bridged
        parent: lxd0
  - name: image
    config:
      user.user-data: |
        #cloud-config
        runcmd:
          - add-apt-repository -y ppa:zebr0/master
          - apt-get update
          - apt-get -y install idem
          - idem run $(cat /etc/hostname)
        power_state:
          mode: poweroff
  - name: container
    config:
      user.user-data: |
        #cloud-config
        ssh_authorized_keys:
          - {{ cat /home/ubuntu/.ssh/id_rsa.pub }}
        runcmd:
          - mv /etc/hostname /etc/containername
          - cat /etc/containername | cut -d'-' -f1 > /etc/hostname
          - cat /etc/containername | cut -d'-' -f2 > /etc/projectname
          - cat /etc/containername | cut -d'-' -f3 > /etc/stagename
          - idem run $(cat /etc/hostname)
        power_state:
          mode: reboot
      boot.autostart: true
